<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="author" content="Jacob Hobzek">
  <meta charset="utf-8">
  <meta name="robots" content="noindex, nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Lato&family=Monoton&display=swap" rel="stylesheet">
  <link href="../css/style.css" rel="stylesheet" type="text/css">
  <title>Museum Cart</title>
  <style>
    /* minimal on-page styles for clarity; move to your CSS later if you want */
    main { max-width: 720px; margin: 0 auto; padding: 16px; }
    .controls { margin: 8px 0 12px; }
    .empty { padding: 12px; border: 1px dashed #666; font-style: italic; }
    pre#summary { background: #f8f8f8; padding: 12px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .actions { margin-top: 12px; display: flex; gap: 8px; }
  </style>
</head>
<body>
  <header>
    <h1>Shopping Cart</h1>
  </header>

  <main>
    <!-- NEW CONTROLS (Cart page only) -->
    <div class="controls">
      <label><input type="checkbox" id="memberToggle"> Member Discount (15%)</label>
    </div>

    <!-- STATES & OUTPUT AREAS -->
    <div id="emptyMsg" class="empty" hidden>Your cart is empty.</div>
    <div id="items" hidden></div>
    <pre id="summary" hidden></pre>

    <!-- BASIC ACTIONS -->
    <div class="actions">
      <button id="clearBtn">Clear Cart</button>
      <a href="shop.html">Keep Shopping</a>
    </div>
  </main>

  <script>
  /* =================== PIPE FROM shop.html (leave as-is) =================== */
  // shop.html must write items with: data-id, data-name, data-price, data-image
  // addToCart(btn) should push objects { id, name, unitPrice, qty, image } to localStorage

  const CART_KEY = 'museumCartV1'; // MUST match shop.html

  function readCart(){
    try { return JSON.parse(localStorage.getItem(CART_KEY)) || []; }
    catch { return []; }
  }
  function writeCart(cart){
    localStorage.setItem(CART_KEY, JSON.stringify(cart));
  }
  /* ================= END PIPE ============================================= */


  /* ====================== UTILITIES & CONSTANTS =========================== */
  // Currency with parentheses for negatives
  function money(n){
    const sign = n < 0 ? -1 : 1;
    const s = '$' + Math.abs(n).toFixed(2);
    return sign < 0 ? '('+s+')' : s;
  }

  // Spec constants
  const TAX_RATE = 0.102;
  const MEMBER_DISCOUNT_RATE = 0.15;
  const SHIPPING_RATE = 25.00;
  const VOLUME_TIERS = [
    [0.00, 49.99, 0.00],
    [50.00, 99.99, 0.05],
    [100.00, 199.99, 0.10],
    [200.00, Infinity, 0.15]
  ];

  // Return the volume discount rate given an item total
  function volumeRate(total){
    for (const [min,max,rate] of VOLUME_TIERS){
      if (total >= min && total <= max) return rate;
    }
    return 0;
  }

  // Remove a line item entirely (qty=0 => drop row)
  function removeItem(id){
    const next = readCart().filter(it => it.id !== id);
    writeCart(next);
    render();
  }

  // Clear cart = initial state (cart empty, member unchecked)
  function clearCart(){
    writeCart([]);
    document.getElementById('memberToggle').checked = false;
    render();
  }
  /* ================== END UTILITIES & CONSTANTS =========================== */


  /* ====================== STUDENT WORK STARTS HERE =========================
     IMPLEMENT render() to mirror the commission assignment:

     1) Load cart from readCart(); keep only items with qty > 0 and unitPrice > 0
     2) If empty → show #emptyMsg and hide #items and #summary
     3) Build a text-only list in #items:
           Example line: "2 × Celestial Inkstone               $29.90"
           Include a small Remove button per line that calls removeItem(id)
     4) Math (single-discount rule):
           ItemTotal = sum(unitPrice * qty)
           If Member checked AND Volume tier would apply → PROMPT user to choose:
             "Only one discount may be applied. Type 'M' for Member or 'V' for Volume:"
             Apply only the chosen one; set the other to $0.00
           Else apply Member OR Volume (not both)
           Subtotal = ItemTotal − AppliedDiscount + SHIPPING_RATE
           TaxAmount = Subtotal * TAX_RATE
           InvoiceTotal = Subtotal + TaxAmount
     5) Write a single summary block to #summary (like commission):
           Subtotal of Items
           Volume Discount
           Member Discount
           Shipping
           Subtotal (Taxable)
           Tax Rate %   (as a percentage text)
           Tax Amount $ (as currency)
           Invoice Total
     6) Recompute (call render()) after:
           - Member checkbox change
           - Clear Cart
           - Remove line item

     KEEP IT SIMPLE: text output only, one render pass.
  ========================================================================= */

  function render(){
    const itemsDiv   = document.getElementById('items');
    const summaryPre = document.getElementById('summary');
    const emptyMsg   = document.getElementById('emptyMsg');
    const isMember   = document.getElementById('memberToggle').checked;
    
    //define the cart from read cart function and filter out items with 0 quantity/ price
    let cart = readCart().filter(item => item.qty > 0 && item.unitPrice > 0);
    // if cart is empty, show empty message
if (cart.length === 0) {
    itemsDiv.hidden = true;
    summaryPre.hidden = true;
    emptyMsg.hidden = false;
    itemsDiv.innerHTML = '';
    summaryPre.innerHTML = '';
    return;  // stop here, nothing else to render
}

// otherwise, continue with rendering items and totals
emptyMsg.hidden = true;
itemsDiv.hidden = false;
summaryPre.hidden = false;

// Render items
itemsDiv.innerHTML = ''; // clear any previous content
cart.forEach(item => {
    const lineTotal = item.unitPrice * item.qty;
    const src = item.image || 'placeholder.png'; 

    // create a <div> for each item
    const itemDiv = document.createElement('div');
    itemDiv.className = 'cart-item';

    // text block with image
    // plus a Remove button
    itemDiv.innerHTML = `
    <img class="cart-thumb" src="${src}" alt="${item.name}" loading="lazy"
         onerror="this.src='placeholder.png'">
        <span>${item.qty} × ${item.name}</span>
        <button onclick="removeItem('${item.id}')">Remove</button>
        <span style="float:right;">${money(lineTotal)}</span>
    `;

    itemsDiv.appendChild(itemDiv);
});
//  Item total
const itemTotal = cart.reduce((sum, it) => sum + it.unitPrice * it.qty, 0);

//  Volume rate 
function volumeRate(total){
  for (const [min, max, rate] of VOLUME_TIERS) {
    if (total >= min && total <= max) return rate;
  }
  return 0; //check for hitting tier
}
// calculating discounts
const vRate           = volumeRate(itemTotal);
const volumeDiscount  = itemTotal * vRate;
const memberDiscount  = isMember ? itemTotal * MEMBER_DISCOUNT_RATE : 0;

// Only one discount allowed
let appliedVolume = 0;
let appliedMember = 0;

if (isMember && vRate > 0) {
  const choice = (prompt("Only one discount may be applied. Type 'M' for Member or 'V' for Volume:") || '')
 .trim().toUpperCase();
  if (choice === 'M') {
    appliedMember = memberDiscount;
  } else {
    appliedVolume = volumeDiscount;
  }
} else if (isMember) {
  appliedMember = memberDiscount;
} else {
  appliedVolume = volumeDiscount;
}

// setting up variables for monetary values (including calculations on previous variables)
const Subtotal   = itemTotal - appliedMember - appliedVolume + SHIPPING_RATE;
const TaxAmount  = Subtotal * TAX_RATE;
const InvoiceTotal = Subtotal + TaxAmount;

// setting up variables for monetary values
const itemTotal$     = money(itemTotal);
const appliedVol$    = money(-appliedVolume);
const appliedMem$    = money(-appliedMember);
const shipping$      = money(SHIPPING_RATE);
const subtotalTax$   = money(Subtotal);
const taxRatePct     = (TAX_RATE * 100).toFixed(1) + '%';
const taxAmount$     = money(TaxAmount);
const invoiceTotal$  = money(InvoiceTotal);
//Single Block Summary 
summaryPre.innerHTML = `
  Subtotal of Items:    ${itemTotal$}
  Volume Discount:      ${appliedVol$}
  Member Discount:      ${appliedMem$}
  Shipping:             ${shipping$}
  Subtotal (Taxable):   ${subtotalTax$}
  Tax Rate %:           ${taxRatePct}
  Tax Amount $:         ${taxAmount$}
  Invoice Total:        ${invoiceTotal$}
`;


document.addEventListener('DOMContentLoaded', render);
  }




   
    




  
`TODO: Implement render() per the assignment spec.

Steps:
1) Load cart from localStorage (readCart)
2) If empty → show 'Your cart is empty.'
3) Build text list of items with Remove buttons
4) Compute totals with exactly one discount (prompt if both apply)
5) Output a single summary block (commission-style)`;
  

  // Events → re-render
  document.getElementById('memberToggle').addEventListener('change', render);
  document.getElementById('clearBtn').addEventListener('click', clearCart);
  function removeItem(id){
  const next = readCart().filter(it => it.id !== id);
  writeCart(next);
  render();
}




  // First paint
  render(); 
  </script>
</body>
</html>
